<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Auth Service · Demo</title>
  <style>
    * { box-sizing: border-box; }
    body { margin:0; min-height:100vh; display:grid; place-items:center; background:#f5f5f7;
           font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .card { width:100%; max-width:420px; background:#fff; border-radius:14px; padding:28px;
            box-shadow: 0 14px 36px rgba(0,0,0,.08); }
    h1 { font-size:20px; margin:0 0 16px; }
    .tabs { display:flex; gap:8px; margin-bottom:16px; }
    .tab { flex:1; padding:10px 12px; text-align:center; background:#f2f2f2; border-radius:10px; cursor:pointer; }
    .tab.active { background:#111; color:#fff; }
    .pane { display:none; }
    .pane.active { display:block; }
    label { display:block; font-size:12px; color:#444; margin:14px 0 6px; }
    input { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; }
    button { width:100%; margin-top:16px; padding:12px; border:0; border-radius:12px; cursor:pointer; }
    button.primary { background:#111; color:#fff; }
    .msg, .err { display:none; margin-top:12px; padding:10px 12px; border-radius:10px; font-size:14px; }
    .msg { background:#e8f5e9; color:#1b5e20; }
    .err { background:#ffebee; color:#b71c1c; }
    footer { margin-top:14px; font-size:12px; color:#777; text-align:center; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Авторизация</h1>
    <div class="tabs">
      <div class="tab active" data-tab="signin">Вход</div>
      <div class="tab" data-tab="signup">Регистрация</div>
      <div class="tab" data-tab="forgot">Забыли пароль</div>
    </div>

    <div id="pane-signin" class="pane active">
      <label>Email</label>
      <input id="login_email" type="email" placeholder="you@example.com" />
      <label>Пароль</label>
      <input id="login_password" type="password" placeholder="••••••••" />
      <button class="primary" id="btnLogin">Войти</button>
    </div>

    <div id="pane-signup" class="pane">
      <label>Email</label>
      <input id="reg_email" type="email" placeholder="you@example.com" />
      <label>Пароль</label>
      <input id="reg_password" type="password" placeholder="минимум 6 символов" />
      <label>Повтор пароля</label>
      <input id="reg_confirm" type="password" placeholder="повторите пароль" />
      <button class="primary" id="btnRegister">Зарегистрироваться</button>
    </div>

    <div id="pane-forgot" class="pane">
      <label>Email</label>
      <input id="forgot_email" type="email" placeholder="you@example.com" />
      <button class="primary" id="btnRecover">Восстановить</button>
    </div>

    <div id="msg" class="msg"></div>
    <div id="err" class="err"></div>


  </div>

<script>
  // Tabs
  const tabs = document.querySelectorAll('.tab');
  const panes = {
    signin: document.getElementById('pane-signin'),
    signup: document.getElementById('pane-signup'),
    forgot: document.getElementById('pane-forgot'),
  };
  const setActive = (name) => {
    tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === name));
    Object.entries(panes).forEach(([k, el]) => el.classList.toggle('active', k === name));
    hideMsg(); hideErr();
  };
  tabs.forEach(t => t.addEventListener('click', () => setActive(t.dataset.tab)));

  const msg = (t) => { const el = document.getElementById('msg'); el.textContent = t; el.style.display='block'; };
  const err = (t) => { const el = document.getElementById('err'); el.textContent = t; el.style.display='block'; };
  const hideMsg = () => document.getElementById('msg').style.display='none';
  const hideErr = () => document.getElementById('err').style.display='none';

  const API = '/api';

  document.getElementById('btnRegister').onclick = async () => {
    hideMsg(); hideErr();
    const email = document.getElementById('reg_email').value.trim();
    const pass = document.getElementById('reg_password').value;
    const conf = document.getElementById('reg_confirm').value;
    if (!email || !pass) return err('Введите email и пароль');
    if (pass !== conf) return err('Пароли не совпадают');
    try {
      const r = await fetch(`${API}/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password: pass })
      });
      const j = await r.json();
      if (r.ok) { msg('Регистрация успешна. Теперь войдите.'); setActive('signin'); }
      else err(j.detail || 'Ошибка регистрации');
    } catch (e) { err('Нет связи с сервером'); }
  };

  document.getElementById('btnLogin').onclick = async () => {
    hideMsg(); hideErr();
    const email = document.getElementById('login_email').value.trim();
    const password = document.getElementById('login_password').value;
    if (!email || !password) return err('Введите email и пароль');
    try {
      const r = await fetch(`${API}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const j = await r.json();
      if (r.ok) {
        msg('Вход выполнен');
        // localStorage.setItem('token', j.access_token);
      } else err(j.detail || 'Неверные учётные данные');
    } catch (e) { err('Нет связи с сервером'); }
  };

  document.getElementById('btnRecover').onclick = () => {
    hideMsg(); hideErr();
    const email = document.getElementById('forgot_email').value.trim();
    msg(`(Демо) Письмо отправлено на ${email}`);
  };
</script>
</body>
</html>